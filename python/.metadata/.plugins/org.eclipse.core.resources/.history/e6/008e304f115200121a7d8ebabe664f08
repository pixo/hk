#!/usr/bin/env python

import couchdb
import argparse

dname="db1"
user="admin:admin"
server = couchdb.Server("http://%s@127.0.0.1:5984" % user)

def createProject(db,projectName):
    doc = {
    "_id": "project_%s" % projectName,
    "type": "project",
    "name": projectName
    }
    _id, _rev = db.save(doc)
    print "Project %r created as Document(%r)" % (projectName, _id)

if dname in server:
    db = server[dname]
    parser = argparse.ArgumentParser()
    projectName=""
    
    try :
        parser.add_argument("name", help="name of the project to create")
        args = parser.parse_args()
        projectName = args.name
        
    except:#not in command line
        projectName="test"
        
    try :
        createProject(db,projectName)
    except couchdb.ResourceConflict():
        print 'Project "%s" already exist' % projectName  
        
else :
    print """Database "%s" doesn't exist""" % dname

